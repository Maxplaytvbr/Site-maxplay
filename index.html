<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta content="#ff6b00" name="theme-color"/>
  <link href="manifest.json" rel="manifest"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>MaxPlay TV - Guia</title>
  <meta content="Guia MaxPlay TV com programação atualizada dos melhores canais, filmes e séries." name="description"/>
  <meta content="MaxPlay TV - Guia" property="og:title"/>
  <meta content="Veja a programação de hoje com filmes, séries e canais ao vivo." property="og:description"/>
  <meta content="https://i.postimg.cc/qB9QRnt9/Logotipo-delicado-monograma-feminino-bege-e-branco.png" property="og:image"/>
  <link href="https://i.postimg.cc/qB9QRnt9/Logotipo-delicado-monograma-feminino-bege-e-branco.png" rel="icon"/>
  <!-- Fontes -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'dark-blue': '#011624',
            'vibrant-orange': '#ff6b00',
            'favorite-yellow': '#facc15',
            'reminder-yellow': '#fde047',
          },
          fontFamily: {
            'sans': ['Poppins', 'sans-serif'],
          },
        }
      }
    }
  </script>
  <style>
    :root {
      --maxplay-orange: #ff6b00;
      --maxplay-dark: #011624;
      --maxplay-light: #f8fafc;
    }

    body {
      background-color: #070c13;
      color: var(--maxplay-light);
      font-family: 'Poppins', sans-serif;
      line-height: 1.6;
      overflow-x: hidden;
      width: 100%;
    }
    
    /* Loader */
    .loading-spinner {
      border: 4px solid rgba(255, 255, 255, 0.1);
      border-left-color: #ff6b00;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Categorias */
    .category-title {
      position: relative;
      padding-left: 15px;
    }
    
    .category-title::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 5px;
      height: 80%;
      background-color: #ff6b00;
      border-radius: 2px;
    }
    
    /* Cards de canal - Modificado para ser mais compacto */
    .channel-card {
      background-color: rgba(255, 255, 255, 0.08);
      transition: all 0.3s ease;
      border: 1px solid rgba(255, 107, 0, 0.5);
      border-radius: 6px;
      display: flex;
      flex-direction: column;
      min-height: 140px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
    }
    
    .channel-card:hover {
      background-color: rgba(255, 255, 255, 0.12);
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
    }
    
    .channel-name {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 140px;
      font-size: 15px;
    }
    
    .programme-item { background-color: transparent;
      border-left: 2px solid #ff6b00;
      transition: all 0.2s ease;
      padding: 0.3rem 0.5rem;
    }
    
    .programme-item:hover {
      background-color: rgba(255, 107, 0, 0.1);
    }
    
    .programme-title, .programme-desc {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .programme-time {
      white-space: nowrap;
    }
    
    /* Filtros */
    .filter-btn {
      transition: all 0.2s ease;
    }
    
    .filter-btn.active {
      background-color: #ff6b00;
      color: white;
      border-bottom: 2px solid white;
    }
    
    .filter-btn:hover:not(.active) {
      background-color: rgba(255, 107, 0, 0.2);
    }
    
    /* Filtro Favoritos - Modificado para ter apenas um coração e cor laranja */
    .filter-btn[data-filter="favorites"] {
      background: linear-gradient(135deg, var(--vibrant-orange), #e67e22) !important;
      color: white !important;
    }

    .filter-btn[data-filter="favorites"] svg {
      display: none;
    }

    .filter-btn[data-filter="favorites"]::before {
      content: ''; /* Removido o coração extra */
      margin-right: 0;
    }
    
    /* Classificação indicativa */
    .rating-icon {
      width: 20px;
      height: 20px;
      display: inline-block;
      vertical-align: middle;
      margin-right: 5px;
    }
    
    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      z-index: 50;
      overflow-y: auto;
    }
    
    .modal-content {
      background-color: #1a2234;
      margin: 5% auto;
      width: 90%;
      max-width: 800px;
      border-radius: 8px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
      animation: modalFadeIn 0.3s;
    }
    
    @keyframes modalFadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .modal-header {
      padding: 15px;
      border-bottom: 1px solid #2d3748;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-body {
      padding: 15px;
      max-height: 70vh;
      overflow-y: auto;
    }
    
    .modal-close {
      color: #a0aec0;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    
    .modal-close:hover {
      color: #ff6b00;
    }
    
    /* Modal de trailer */
    .trailer-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.9);
      z-index: 100;
    }
    
    .trailer-modal-content {
      position: relative;
      width: 90%;
      max-width: 900px;
      margin: 5% auto;
      background-color: #1a2234;
      border-radius: 8px;
      padding: 20px;
      animation: modalFadeIn 0.3s;
    }
    
    .trailer-iframe-container {
      position: relative;
      padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
      height: 0;
      overflow: hidden;
    }
    
    .trailer-iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: none;
    }
    
    .trailer-not-found {
      padding: 40px;
      text-align: center;
      color: #fff;
    }
    
    /* Scrollbar personalizada */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: rgba(255, 107, 0, 0.5);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 107, 0, 0.8);
    }
    
    /* Hora atual */
    .current-time {
      background-color: rgba(255, 107, 0, 0.2);
      border: 1px solid #ff6b00;
      border-radius: 4px;
      padding: 4px 8px;
      font-size: 0.875rem;
      display: inline-flex;
      align-items: center;
    }
    
    /* Indicador AO VIVO */
    .live-indicator {
      display: inline-flex;
      align-items: center;
      background-color: rgba(220, 38, 38, 0.2);
      color: #ef4444;
      border-radius: 4px;
      padding: 1px 6px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-left: 8px;
    }
    
    .live-indicator::before {
      content: '';
      width: 6px;
      height: 6px;
      background-color: #ef4444;
      border-radius: 50%;
      margin-right: 4px;
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }
    
    /* Em breve */
    .soon-indicator {
      display: inline-flex;
      align-items: center;
      background-color: rgba(234, 179, 8, 0.2);
      color: #eab308;
      border-radius: 4px;
      padding: 1px 6px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-left: 8px;
    }
    
    .soon-indicator::before {
      content: '⏱';
      margin-right: 4px;
    }
    
    /* Dias da semana abreviados */
    .weekday {
      font-size: 0.75rem;
      color: #a0aec0;
      margin-left: 2px;
    }
    
    /* Cards de filmes - Modificado para ajustar títulos e datas */
    .movie-card {
      min-width: 160px;
      max-width: 180px;
      height: 460px; /* Aumentado para comportar todos os elementos com mais folga */
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: 6px;
      padding: 0.75rem;
      flex-shrink: 0;
      transition: transform 0.3s ease;
      position: relative;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      cursor: pointer;
    }
    
    .movie-card:hover {
      transform: translateY(-5px);
    }
    
    .movie-card-live {
      border: 2px solid #ef4444;
      box-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
    }
    
    .live-badge {
      position: absolute;
      top: 10px;
      left: 10px;
      background-color: #ef4444;
      color: white;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: bold;
      z-index: 2;
      animation: pulse 1.5s infinite;
    }
    
    .movie-poster-container {
      position: relative;
    }
    
    .movie-card h3 {
      font-size: 13px;
      line-height: 1.3;
      max-height: 2.6em;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }
    
    .movie-card .text-xs.bg-gray-700 {
      padding: 2px 4px;
      font-size: 10px;
    }
    
    /* Botão Voltar ao Topo */
    #back-to-top {
      transition: all 0.3s ease;
      white-space: nowrap;
      overflow: hidden;
    }
    
    #back-to-top:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 8px rgba(255, 107, 0, 0.3);
    }
    
    /* Coração de favoritos - Modificado para laranja */
    .favorite-heart {
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 1.2rem;
      color: var(--vibrant-orange);
    }
    
    .favorite-heart:hover {
      transform: scale(1.2);
    }
    
    .favorite-heart.active {
      color: var(--vibrant-orange);
      text-shadow: 0 0 8px rgba(255, 107, 0, 0.5);
    }
    
    /* Canal logo em cards de filmes - Aumentado */
    .channel-logo {
      height: 24px;
      width: auto;
      object-fit: contain;
      margin-right: 5px;
      vertical-align: middle;
    }
    
    /* Botão de lembrete */
    .definir-lembrete {font-size: 10px;margin-top: 8px;display: block;width: 100%;text-align: center;padding: 4px;background-color: rgba(255, 107, 0, 0.3);border: 1px solid rgba(255, 107, 0, 0.5);color: white;border-radius: 4px;cursor: pointer;transition: background-color 0.3s ease;}
    
    .definir-lembrete:hover {
      background-color: rgba(255, 107, 0, 0.3);
      transform: translateY(-1px);
    }
    
    /* Toast de confirmação */
    .reminder-toast {
      animation: fadeIn 0.3s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Rating Circle */
    .rating-circle {
      position: absolute;
      bottom: 10px;
      left: 10px;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background-color: #070c13;
      border: 3px solid;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 11px;
      z-index: 2;
    }
    
    .rating-high {
      border-color: #21d07a;
      color: #21d07a;
    }
    
    .rating-medium {
      border-color: #d2d531;
      color: #d2d531;
    }
    
    .rating-low {
      border-color: #db2360;
      color: #db2360;
    }
    
    /* Header - Logo aumentada */
    header {
      width: 100%;
      box-sizing: border-box;
      position: relative;
      z-index: 10;
    }

    header img {
      height: 70px;
      padding: 0 !important;
      object-fit: contain;
    }

    /* Cronômetro */
    #current-time-display {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      min-width: 80px;
    }
    
    /* Modal de detalhes do filme */
    .movie-details-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.9);
      z-index: 100;
      overflow-y: auto;
    }
    
    .movie-details-content {
      position: relative;
      width: 90%;
      max-width: 800px;
      margin: 5% auto;
      background-color: #1a2234;
      border-radius: 8px;
      padding: 20px;
      animation: modalFadeIn 0.3s;
    }
    
    .movie-details-close {
      position: absolute;
      top: 15px;
      right: 15px;
      color: #a0aec0;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    
    .movie-details-close:hover {
      color: #ff6b00;
    }
    
    .movie-details-header {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    @media (min-width: 768px) {
      .movie-details-header {
        flex-direction: row;
      }
    }
    
    .movie-details-poster {
      flex-shrink: 0;
      width: 100%;
      max-width: 300px;
      border-radius: 8px;
      overflow: hidden;
    }
    
    .movie-details-poster img {
      width: 100%;
      height: auto;
      object-fit: cover;
    }
    
    .movie-details-info {
      flex-grow: 1;
    }
    
    .movie-details-title {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 10px;
      color: white;
    }
    
    .movie-details-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 15px;
      color: #a0aec0;
      font-size: 14px;
    }
    
    .movie-details-overview {
      margin-bottom: 20px;
      line-height: 1.6;
    }
    
    .movie-details-rating {
      display: flex;
      align-items: center;
      gap: 5px;
      margin-bottom: 15px;
    }
    
    .movie-details-rating-value {
      font-weight: bold;
      color: #ff6b00;
    }
    
    .movie-details-cast {
      margin-top: 30px;
    }
    
    .movie-details-cast-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 15px;
      color: white;
      border-bottom: 1px solid #2d3748;
      padding-bottom: 5px;
    }
    
    .movie-details-cast-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 15px;
    }
    
    .movie-details-cast-member {
      text-align: center;
    }
    
    .movie-details-cast-photo {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      margin: 0 auto 5px;
      background-color: #2d3748;
    }
    
    .movie-details-cast-name {
      font-size: 12px;
      color: white;
      margin-bottom: 2px;
    }
    
    .movie-details-cast-character {
      font-size: 11px;
      color: #a0aec0;
    }
    
    /* Responsividade */
    @media (max-width: 640px) {
      .filters-container {
        overflow-x: auto;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch;
        padding-bottom: 10px;
      }
      
      .modal-content {
        width: 95%;
        margin: 10% auto;
      }
      
      .channel-card {
        min-height: 140px;
      }
      
      .movie-card {
        min-width: 140px;
        height: 440px;
      }
      
      .movie-details-content {
        width: 95%;
        margin: 10% auto;
      }
      
      .movie-details-header {
        flex-direction: column;
      }
      
      .movie-details-poster {
        max-width: 100%;
      }
      
      .movie-details-cast-list {
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      }
    }
    
    @media (max-width: 400px) {
      .channel-card {
        min-height: auto;
      }
      
      .programme-title, .programme-desc {
        font-size: 0.9rem;
      }
    }

    /* Trailer button */
    .ver-trailer-btn {
      width: 100%;
      margin-top: auto;
      padding: 8px;
      font-size: 14px;
    }
    
    /* Mais detalhes button */
    .mais-detalhes-btn {
      width: 100%;
      margin-top: 8px;
      padding: 8px;
      font-size: 14px;
      background-color: rgba(255, 107, 0, 0.3);
      border: 1px solid rgba(255, 107, 0, 0.5);
      color: white;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      text-align: center;
    }
    
    .mais-detalhes-btn:hover {
      background-color: rgba(255, 107, 0, 0.5);
    }
  </style>
</head>
<body>
  <header class="w-full bg-vibrant-orange flex items-center justify-between px-4 h-16">
    <img alt="MaxPlay Logo" class="h-14 max-h-full object-contain ml-2" src="https://i.postimg.cc/qB9QRnt9/Logotipo-delicado-monograma-feminino-bege-e-branco.png"/>
    <button class="text-white text-3xl focus:outline-none" id="menu-button">
      ☰
    </button>
  </header>
  
  <!-- Barra de busca com botão e relógio -->
  <div class="flex items-center px-4 mt-2 gap-2 relative">
    <input class="flex-1 h-10 px-4 rounded-lg bg-gray-800 text-white placeholder-gray-400 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-vibrant-orange text-sm transition-all"
           id="channel-search" 
           placeholder="Buscar canal ou programa..." 
           type="text"
           aria-label="Buscar canal ou programa">
    <button class="h-10 w-12 min-w-[3rem] flex-shrink-0 flex items-center justify-center bg-vibrant-orange border border-vibrant-orange rounded-lg p-0 overflow-hidden transition-colors hover:bg-orange-700"
            onclick="location.reload()" 
            title="Recarregar"
            aria-label="Recarregar página">
      <img alt="Recarregar" class="h-6 w-6 object-contain" src="https://i.postimg.cc/VsSDm4Nq/Logotipo-delicado-monograma-feminino-bege-e-branco.png">
    </button>
    <div class="h-10 px-3 flex items-center bg-gray-800 border border-vibrant-orange text-sm rounded-lg text-white" id="current-time-display">
      Carregando...
    </div>
  </div>
  
  <div class="flex justify-center mt-1 text-xs text-gray-400">
    Última atualização:
    <span class="ml-1" id="last-update">
      --:--
    </span>
  </div>
  
  <!-- Botão Voltar ao Topo -->
  <button class="fixed bottom-4 right-4 bg-vibrant-orange text-white p-3 rounded-full shadow-lg hidden z-50" id="back-to-top">
    <svg aria-hidden="true" class="h-6 w-6" fill="none" role="img" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path d="M5 10l7-7m0 0l7 7m-7-7v18" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
      </path>
    </svg>
  </button>
  
  <!-- Modal de Trailer -->
  <div class="trailer-modal" id="trailer-modal">
    <div class="trailer-modal-content">
      <span class="trailer-close">
        ×
      </span>
      <div class="trailer-iframe-container" id="trailer-container">
        <div class="trailer-not-found hidden" id="trailer-not-found">
          <p>
            Trailer não encontrado para este filme.
          </p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modal de Detalhes do Filme -->
  <div class="movie-details-modal" id="movie-details-modal">
    <div class="movie-details-content">
      <span class="movie-details-close" id="movie-details-close">
        ×
      </span>
      <div id="movie-details-body">
        <!-- O conteúdo será preenchido dinamicamente -->
      </div>
    </div>
  </div>
  
  <!-- Botão do menu hambúrguer -->
  <div class="fixed top-4 right-4 z-50 block md:hidden">
  </div>
  
  <!-- Drawer lateral -->
  <div class="fixed top-0 right-0 w-64 h-full bg-gray-900 shadow-lg z-40 transform translate-x-full transition-transform duration-300 ease-in-out" id="side-menu">
    <div class="flex justify-between items-center p-4 border-b border-gray-700">
      <span class="text-white font-semibold text-lg">
        Menu
      </span>
      <button class="text-white text-2xl" id="close-menu">
        ×
      </button>
    </div>
    <nav class="flex flex-col text-white p-4 space-y-3">
      <button class="text-left" onclick="document.getElementById('filmes-destaque').scrollIntoView({ behavior: 'smooth' })">
        🎬 Destaques
      </button>
      <button class="text-left" onclick="document.getElementById('channels-container').scrollIntoView({ behavior: 'smooth' })">
        📺 Todos os Canais
      </button>
      <button class="text-left" onclick="mostrarSobre()">
        ⚙️ Sobre
      </button>
      <button class="text-left" onclick="logout()">
        ➡️ Sair
      </button>
      <a class="text-left" href="https://wa.me/5583981647312" target="_blank">
        💬 Suporte (WhatsApp)
      </a>
      <a class="text-left" href="https://chat.whatsapp.com/H4uqhUcglUC5i4eZ4FlA1F" target="_blank">
        👥 Grupo Guia (WhatsApp)
      </a>
    </nav>
  </div>
  
  <!-- Overlay -->
  <div class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden" id="menu-overlay">
  </div>
  
  <!-- Seção de Filmes em Destaque -->
  <section class="px-4 py-6 text-white" id="filmes-destaque">
    <h2 class="text-2xl font-bold mb-1 text-orange-500">
      🎬 Destaques do Dia
    </h2>
    <p class="text-sm text-gray-300 mb-4">
      Acompanhe aqui os filmes que ainda vão passar hoje nos principais canais.
    </p>
    <div class="flex gap-4 overflow-x-auto pb-4" id="filmes">
      <div class="loading-spinner mx-auto">
      </div>
    </div>
  </section>
  
  <!-- Seção Principal de Canais -->
  <div class="container mx-auto px-4 py-6">
    <div class="flex justify-center items-center h-40" id="loading">
      <div class="loading-spinner">
      </div>
      <p class="ml-4 text-gray-300">
        Carregando programação...
      </p>
    </div>
    <div class="hidden bg-red-900 border border-red-700 text-white px-4 py-3 rounded mb-4" id="error-message">
    </div>
    
    <h2 class="text-2xl font-bold mb-1 text-orange-500">
      🔎 O Que Está Passando Agora na TV?
    </h2>
    <p class="text-sm text-gray-300 mb-4">
      Acompanhe todas as programações que estão passando e ainda vão passar nos principais canais.
    </p>
    
    <div class="filters-container overflow-x-auto pb-2">
      <div class="flex space-x-2 mb-4">
        <button class="filter-btn px-3 py-1.5 rounded-md bg-gray-800 text-sm font-medium" data-filter="favorites">
          ❤️ Favoritos
        </button>
        <button class="filter-btn active px-3 py-1.5 rounded-md bg-gray-800 text-sm font-medium" data-filter="all">
          Todos
        </button>
        <button class="filter-btn px-3 py-1.5 rounded-md bg-gray-800 text-sm font-medium" data-filter="movies">
          Filmes e Séries
        </button>
        <button class="filter-btn px-3 py-1.5 rounded-md bg-gray-800 text-sm font-medium" data-filter="documentary">
          Documentários
        </button>
        <button class="filter-btn px-3 py-1.5 rounded-md bg-gray-800 text-sm font-medium" data-filter="kids">
          Infantis
        </button>
        <button class="filter-btn px-3 py-1.5 rounded-md bg-gray-800 text-sm font-medium" data-filter="sports">
          Esportes
        </button>
        <button class="filter-btn px-3 py-1.5 rounded-md bg-gray-800 text-sm font-medium" data-filter="adult">
          Adulto
        </button>
        <button class="filter-btn px-3 py-1.5 rounded-md bg-gray-800 text-sm font-medium" data-filter="open">
          Canais Abertos
        </button>
        <button class="filter-btn px-3 py-1.5 rounded-md bg-gray-800 text-sm font-medium" data-filter="news">
          Notícias
        </button>
        <button class="filter-btn px-3 py-1.5 rounded-md bg-gray-800 text-sm font-medium" data-time="morning">
          Manhã
        </button>
        <button class="filter-btn px-3 py-1.5 rounded-md bg-gray-800 text-sm font-medium" data-time="afternoon">
          Tarde
        </button>
        <button class="filter-btn px-3 py-1.5 rounded-md bg-gray-800 text-sm font-medium" data-time="evening">
          Noite
        </button>
      </div>
    </div>
    
    <div class="hidden" id="channels-container">
      <!-- Seção de Filmes e Séries -->
      <section class="mb-8" id="movies-section">
        <h2 class="category-title text-xl font-bold mb-4 text-vibrant-orange">
          Filmes e Séries
        </h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4" id="movies-channels">
        </div>
      </section>
      
      <!-- Seção de Documentários -->
      <section class="mb-8" id="documentary-section">
        <h2 class="category-title text-xl font-bold mb-4 text-vibrant-orange">
          Documentários
        </h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4" id="documentary-channels">
        </div>
      </section>
      
      <!-- Seção Infantil -->
      <section class="mb-8" id="kids-section">
        <h2 class="category-title text-xl font-bold mb-4 text-vibrant-orange">
          Infantis
        </h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4" id="kids-channels">
        </div>
      </section>
      
      <!-- Seção de Esportes -->
      <section class="mb-8" id="sports-section">
        <h2 class="category-title text-xl font-bold mb-4 text-vibrant-orange">
          Esportes
        </h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4" id="sports-channels">
        </div>
      </section>
      
      <!-- Seção de Outros Canais -->
      <section class="mb-8" id="other-section">
        <h2 class="category-title text-xl font-bold mb-4 text-vibrant-orange">
          Outros Canais
        </h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4" id="other-channels">
        </div>
      </section>
    </div>
  </div>
  
  <!-- Modal de Programação Completa -->
  <div class="modal" id="schedule-modal">
    <div class="modal-content">
      <div class="modal-header bg-gray-800">
        <div class="flex items-center">
          <img alt="Channel Logo" class="h-8 mr-2" id="modal-channel-logo" src=""/>
          <h3 class="text-lg font-bold text-white" id="modal-channel-name">
            Canal
          </h3>
        </div>
        <span class="modal-close">
          ×
        </span>
      </div>
      <div class="modal-body">
        <div class="space-y-3" id="modal-schedule-list">
        </div>
      </div>
    </div>
  </div>
  
  <!-- JavaScript -->
  <script>
    // Configurações globais
    const tmdbApiKey = "54b9cff0f48a3f127fa5cd5906bbe251";
    const epgXmlUrl = "https://raw.githubusercontent.com/limaalef/BrazilTVEPG/main/vivoplay.xml";
    
    // Mapeamento de logos de canais
    const channelLogos = {
      'Warner': 'https://i.postimg.cc/SxBRcBBk/IMG-6821.png',
      'Sony': 'https://i.postimg.cc/bwDdDyFm/IMG-6878.jpg',
      'TNT': 'https://i.postimg.cc/kXhBg6wV/IMG-6879.png',
      'TNT Novelas': 'https://i.postimg.cc/1RB8bYqr/IMG-6880.jpg',
      'Space': 'https://i.postimg.cc/BbknDNcs/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-35.png',
      'Cinemax': 'https://i.postimg.cc/dV8Vk27P/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-34.png',
      'Megapix': 'https://i.postimg.cc/fLjVz8gZ/IMG-6883.jpg',
      'Sony Movies': 'https://i.postimg.cc/mDGcWvj8/IMG-6884.jpg',
      'Fox': 'https://i.postimg.cc/0NS63kYz/IMG-6885.jpg',
      'Animal Planet': 'https://i.postimg.cc/pXdmvYQb/IMG-6886.png',
      'History': 'https://i.postimg.cc/bvgYLqHm/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-30.png',
      'Discovery Kids': 'https://i.postimg.cc/bwWD3DtX/IMG-6888.png',
      'Band': 'https://i.postimg.cc/c41nHNSz/IMG-6889.png',
      'Band Sports': 'https://i.postimg.cc/Pr68vFf5/IMG-6890.png',
      'Globo': 'https://logodownload.org/wp-content/uploads/2013/12/rede-globo-logo-0.png',
      'SBT': 'https://logodownload.org/wp-content/uploads/2013/12/sbt-logo-0.png',
      'Record': 'https://logodownload.org/wp-content/uploads/2014/02/record-logo-tv-0.png',
      'HBO': 'https://logodownload.org/wp-content/uploads/2017/04/hbo-logo-1.png',
      'Telecine': 'https://logodownload.org/wp-content/uploads/2017/07/telecine-logo-1.png',
      'SporTV': 'https://i.postimg.cc/G2NCStBx/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-19.png',
      'ESPN': 'https://logodownload.org/wp-content/uploads/2015/05/espn-logo-4.png',
      'Discovery': 'https://logodownload.org/wp-content/uploads/2017/04/discovery-channel-logo-1.png',
      'Cartoon Network': 'https://i.postimg.cc/hvTtLTCd/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-6.png',
      'Nickelodeon': 'https://i.postimg.cc/ncmHg4Gj/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-24.png',
      'Disney': 'https://logodownload.org/wp-content/uploads/2018/10/disney-channel-logo-1.png',
      'GloboNews': 'https://logodownload.org/wp-content/uploads/2017/07/globo-news-logo-0.png',
      'CNN Brasil': 'https://i.postimg.cc/3RPw0nZh/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-5.png',
      "AMC": "https://i.postimg.cc/YSz0V6kf/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-39.png",
      "AXN": "https://i.postimg.cc/T1pPpBbC/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-37.png",
      "A&E": "https://i.postimg.cc/76B6Pq55/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-38.png",
      "Prime Box Brazil": "https://i.postimg.cc/bYBJKNXM/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-36.png",
      "Comedy Central": "https://i.postimg.cc/TY5wGMfP/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-33.png",
      "Paramount Network": "https://i.postimg.cc/CxyKxPxs/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-32.png",
      "TLC": "https://i.postimg.cc/Prt90bJs/IMG-6917.png",
      "E!": "https://i.postimg.cc/SND34XYX/IMG-6918.jpg",
      "Arte 1": "https://i.postimg.cc/VkvTkYXK/IMG-6919.png",
      "Fish": "https://i.postimg.cc/gJ0zT1gm/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-26.png",
      "Nick Jr.": "https://i.postimg.cc/66gWMjnx/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-25.png",
      "Cartoonito": "https://i.postimg.cc/Gm1cC4XM/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-22.png",
      "Premiere": "https://i.postimg.cc/dQ9SR7BW/IMG-6926.png",
      "RedeTV!": "https://i.postimg.cc/xTTp60p9/IMG-6927.png",
      "TNT Series": "https://i.postimg.cc/SKhjDT0x/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-40.png",
      "Lifetime": "https://i.postimg.cc/Kzcjy18X/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-41.png",
      "Fox News": "https://i.postimg.cc/pL8pQN6S/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-42.png",
      "Travel Box": "https://i.postimg.cc/XJDjSxPF/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-29.png",
      "ZooMoo": "https://i.postimg.cc/9QtcFcSc/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-23.png",
      "Woohoo": "https://i.postimg.cc/N0sBKWqm/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-21.png",
      "TV Câmara": "https://i.postimg.cc/J0kLw8ZV/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-18.png",
      "TV Brasil": "https://i.postimg.cc/263Ywh55/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-17.png",
      "TV Cultura": "https://i.postimg.cc/QN99NWqs/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-15.png",
      "Rede Brasil": "https://i.postimg.cc/05T6z2tS/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-14.png",
      "TV Gazeta": "https://i.postimg.cc/G2B2pZGz/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-13.png",
      "Rede Vida": "https://i.postimg.cc/ZK6WptgM/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-11.png",
      "TV Aparecida": "https://i.postimg.cc/Vk1dFZPL/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-10.png",
      "Canção Nova": "https://i.postimg.cc/bvwr7Gv7/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-9.png",
      "TV Rá-Tim-Bum": "https://i.postimg.cc/Bv7b4qLX/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-8.png",
      "Dreamworks": "https://i.postimg.cc/fW9yQQwR/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-7.png",
      "CNN Brasil": "https://i.postimg.cc/3RPw0nZh/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-5.png",
      "Jovem Pan News": "https://i.postimg.cc/jSsSfWyD/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-3.png",
      "Boomerang": "https://i.postimg.cc/28d53dLp/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-2.png",
      "Agro+": "https://i.postimg.cc/13J5r9KJ/Amarelo-Preto-e-Vermelho-Ilustrado-Festa-Junina-Post-para-Instagram-zip-1.png"
    };

    // Classificação indicativa
    const ratingImages = {
      'L': 'https://i.postimg.cc/ZRcPMmQF/IMG-7033.png',
      '10': 'https://i.postimg.cc/NGd78gmQ/IMG-7031.png',
      '12': 'https://i.postimg.cc/Wz1mRKLR/IMG-7032.png',
      '14': 'https://i.postimg.cc/Xq1fn84r/IMG-7030.png',
      '16': 'https://i.postimg.cc/3JWjnPFm/IMG-7028.png',
      '18': 'https://i.postimg.cc/PrcWc2Sc/IMG-7034.png'
    };
    
    // Dias da semana abreviados
    const weekdaysShort = {
      0: 'dom', 1: 'seg', 2: 'ter', 3: 'qua', 4: 'qui', 5: 'sex', 6: 'sab'
    };
    
    // Categorias de canais
    const channelCategories = {
      'movies': ['HBO', 'HBO2', 'HBO Plus', 'HBO Family', 'HBO Signature', 'HBO Mundi', 'HBO Pop', 'HBO Xtreme', 
                'Telecine Premium', 'Telecine Action', 'Telecine Touch', 'Telecine Fun', 'Telecine Pipoca', 'Telecine Cult',
                'Megapix', 'Universal TV', 'Studio Universal', 'Warner', 'AXN', 'Sony', 'FX', 'Paramount Network',
                'Cinemax', 'Prime Box Brazil', 'TNT', 'TNT Series', 'TNT Novelas', 'Space', 'AMC', 'Film&Arts', 'Syfy', 'Comedy Central',
                'TBS', 'A&E', 'Star Channel', 'Lifetime', 'Canal Brasil', 'TCM', 'Cine Brasil TV', 'CineBrasilTV', 'Sony Movies', 'Fox'],
      
      'documentary': ['Discovery Channel', 'Animal Planet', 'Nat Geo', 'National Geographic', 'History', 'History 2', 'Discovery Science', 
                     'Discovery Theater', 'Discovery World', 'Discovery Turbo', 'Discovery Home & Health', 'Discovery ID', 'TLC', 
                     'E!', 'Curta!', 'Arte 1', 'Fashion TV', 'Travel Box Brazil', 'Fish TV', 'Smithsonian Channel'],
      
      'kids': ['Cartoon Network', 'Nickelodeon', 'Nick Jr.', 'Disney Channel', 'Disney Junior', 'Discovery Kids', 'Gloob', 
              'Gloobinho', 'Tooncast', 'Cartoonito', 'ZooMoo', 'TV Rá-Tim-Bum', 'Nat Geo Kids'],
      
      'sports': ['SporTV', 'SporTV 2', 'SporTV 3', 'ESPN', 'ESPN 2', 'ESPN 3', 'ESPN 4', 'Fox Sports', 'Fox Sports 2', 
                'Band Sports', 'Premiere', 'Premiere 2', 'Premiere 3', 'Premiere 4', 'Premiere 5', 'Premiere 6', 
                'Premiere 7', 'Premiere 8', 'Combate', 'OFF', 'Woohoo'],
      
      'news': ['GloboNews', 'CNN Brasil', 'Record News', 'BandNews', 'Jovem Pan News', 'Bloomberg'],
      
      'open': ['Globo', 'SBT', 'Record', 'Band', 'RedeTV!', 'TV Cultura', 'TV Brasil', 'TV Gazeta', 'Futura', 'TV Câmara', 'TV Senado', 'TV Justiça'],
      
      'adult': ['Playboy TV', 'Sexy Hot', 'Venus', 'Sextreme', 'Hustler TV', 'Penthouse TV']
    };

    // Inicialização quando o DOM estiver pronto
    document.addEventListener('DOMContentLoaded', () => {
      // Elementos da interface
      const loadingElement = document.getElementById('loading');
      const errorElement = document.getElementById('error-message');
      const channelsContainer = document.getElementById('channels-container');
      const channelSearch = document.getElementById('channel-search');
      const currentTimeDisplay = document.getElementById('current-time-display');
      const lastUpdateDisplay = document.getElementById('last-update');
      const backToTopButton = document.getElementById('back-to-top');
      const trailerModal = document.getElementById('trailer-modal');
      const trailerClose = document.querySelector('.trailer-close');
      const trailerContainer = document.getElementById('trailer-container');
      const trailerNotFound = document.getElementById('trailer-not-found');
      const modal = document.getElementById('schedule-modal');
      const modalClose = document.querySelector('.modal-close');
      const modalChannelName = document.getElementById('modal-channel-name');
      const modalChannelLogo = document.getElementById('modal-channel-logo');
      const modalScheduleList = document.getElementById('modal-schedule-list');
      
      // Elementos do modal de detalhes do filme
      const movieDetailsModal = document.getElementById('movie-details-modal');
      const movieDetailsClose = document.getElementById('movie-details-close');
      const movieDetailsBody = document.getElementById('movie-details-body');
      
      // Containers de canais por categoria
      const moviesChannels = document.getElementById('movies-channels');
      const documentaryChannels = document.getElementById('documentary-channels');
      const kidsChannels = document.getElementById('kids-channels');
      const sportsChannels = document.getElementById('sports-channels');
      const otherChannels = document.getElementById('other-channels');
      
      // Filtros
      const filterButtons = document.querySelectorAll('.filter-btn');
      
      // Variáveis de estado
      let allProgrammesByChannel = {};
      let autoUpdateTimer = null;
      const AUTO_UPDATE_INTERVAL = 300000; // 5 minutos
      let favoriteChannels = JSON.parse(localStorage.getItem('favoriteChannels')) || {};
      const trailerCache = JSON.parse(localStorage.getItem('trailerCache')) || {};
      let reminders = JSON.parse(localStorage.getItem('filmReminders')) || {};
      
      // =============================================
      // FUNÇÕES DO MODAL DE DETALHES DO FILME
      // =============================================
      
      // Função para abrir o modal de detalhes do filme
      async function abrirDetalhesFilme(tituloFilme, channel, startTime) {
        // Mostrar loading no modal
        movieDetailsBody.innerHTML = '<div class="loading-spinner mx-auto my-20"></div>';
        movieDetailsModal.style.display = 'block';
        
        try {
          // Buscar detalhes do filme na API do TMDB
          const tituloNormalizado = normalizarTitulo(tituloFilme);
          const urlBusca = `https://api.themoviedb.org/3/search/movie?api_key=${tmdbApiKey}&query=${encodeURIComponent(tituloNormalizado)}`;
          
          const respostaBusca = await fetch(urlBusca);
          const dadosBusca = await respostaBusca.json();
          
          if (!dadosBusca.results?.length) {
            movieDetailsBody.innerHTML = '<p class="text-center py-10 text-gray-400">Nenhuma informação encontrada para este filme.</p>';
            return;
          }
          
          // Pegar o primeiro resultado (assumindo que é o mais relevante)
          const filmeId = dadosBusca.results[0].id;
          
          // Buscar detalhes completos e créditos
          const [detalhesResposta, creditosResposta] = await Promise.all([
            fetch(`https://api.themoviedb.org/3/movie/${filmeId}?api_key=${tmdbApiKey}&language=pt-BR`),
            fetch(`https://api.themoviedb.org/3/movie/${filmeId}/credits?api_key=${tmdbApiKey}`)
          ]);
          
          const [detalhes, creditos] = await Promise.all([
            detalhesResposta.json(),
            creditosResposta.json()
          ]);
          
          // Construir o HTML do modal
          let html = `
            <div class="movie-details-header">
              <div class="movie-details-poster">
                <img src="${detalhes.poster_path ? `https://image.tmdb.org/t/p/w500${detalhes.poster_path}` : 'https://via.placeholder.com/500x750?text=Poster+Não+Disponível'}" alt="${detalhes.title}">
              </div>
              <div class="movie-details-info">
                <h1 class="movie-details-title">${detalhes.title}</h1>
                <div class="movie-details-meta">
                  ${detalhes.release_date ? `<span>${new Date(detalhes.release_date).toLocaleDateString('pt-BR')}</span>` : ''}
                  ${detalhes.runtime ? `<span>${Math.floor(detalhes.runtime / 60)}h ${detalhes.runtime % 60}m</span>` : ''}
                  ${detalhes.genres?.length ? `<span>${detalhes.genres.map(g => g.name).join(', ')}</span>` : ''}
                </div>
                <div class="movie-details-rating">
                  <span class="movie-details-rating-value">${detalhes.vote_average ? detalhes.vote_average.toFixed(1) : 'N/A'}</span>
                  <span>/10 (${detalhes.vote_count ? detalhes.vote_count : '0'} votos)</span>
                </div>
                <div class="movie-details-overview">
                  <h3 class="font-bold mb-2">Sinopse</h3>
                  <p>${detalhes.overview || 'Sinopse não disponível.'}</p>
                </div>
                <div class="movie-details-channel-info">
                  <p><strong>Canal:</strong> ${channel}</p>
                  <p><strong>Horário:</strong> ${new Date(startTime).toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'})}</p>
                </div>
              </div>
            </div>
          `;
          
          // Adicionar elenco se disponível
          if (creditos.cast?.length) {
            html += `
              <div class="movie-details-cast">
                <h3 class="movie-details-cast-title">Elenco Principal</h3>
                <div class="movie-details-cast-list">
            `;
            
            // Pegar os 10 primeiros atores
            const elencoPrincipal = creditos.cast.slice(0, 10);
            
            for (const ator of elencoPrincipal) {
              html += `
                <div class="movie-details-cast-member">
                  <img src="${ator.profile_path ? `https://image.tmdb.org/t/p/w185${ator.profile_path}` : 'https://via.placeholder.com/185x278?text=Sem+Foto'}" 
                       alt="${ator.name}" 
                       class="movie-details-cast-photo"
                       onerror="this.onerror=null;this.src='https://via.placeholder.com/185x278?text=Sem+Foto'">
                  <div class="movie-details-cast-name">${ator.name}</div>
                  <div class="movie-details-cast-character">${ator.character || 'Personagem'}</div>
                </div>
              `;
            }
            
            html += `
                </div>
              </div>
            `;
          }
          
          movieDetailsBody.innerHTML = html;
          
        } catch (error) {
          console.error('Erro ao buscar detalhes do filme:', error);
          movieDetailsBody.innerHTML = '<p class="text-center py-10 text-red-400">Erro ao carregar informações do filme.</p>';
        }
      }
      
      // Função para fechar o modal de detalhes
      function fecharModalDetalhes() {
        movieDetailsModal.style.display = 'none';
      }
      
      // Configurar eventos do modal de detalhes
      movieDetailsClose.addEventListener('click', fecharModalDetalhes);
      window.addEventListener('click', (event) => {
        if (event.target === movieDetailsModal) {
          fecharModalDetalhes();
        }
      });
      
      // =============================================
      // FUNÇÕES PRINCIPAIS
      // =============================================
      
      function updateCurrentTime() {
        const now = new Date();
        currentTimeDisplay.textContent = now.toLocaleTimeString('pt-BR', {
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit'
        });
      }
      
      function handleSearch(e) {
        const searchTerm = e.target.value.toLowerCase();
        const channelCards = document.querySelectorAll('.channel-card');
        
        channelCards.forEach(card => {
          const channelName = card.querySelector('.channel-name').textContent.toLowerCase();
          const programmes = Array.from(card.querySelectorAll('.programme-title')).map(el => el.textContent.toLowerCase());
          
          if (channelName.includes(searchTerm) || programmes.some(prog => prog.includes(searchTerm))) {
            card.classList.remove('hidden');
          } else {
            card.classList.add('hidden');
          }
        });
        
        checkEmptySections();
      }
      
      function handleReload() {
        loadingElement.classList.remove('hidden');
        channelsContainer.classList.add('hidden');
        errorElement.classList.add('hidden');
        
        moviesChannels.innerHTML = '';
        documentaryChannels.innerHTML = '';
        kidsChannels.innerHTML = '';
        sportsChannels.innerHTML = '';
        otherChannels.innerHTML = '';
        
        if (autoUpdateTimer) clearInterval(autoUpdateTimer);
        
        fetchEPGData();
        carregarFilmes();
      }
      
      function handleFilterClick() {
        filterButtons.forEach(btn => {
          if (!btn.dataset.time) {
            btn.classList.remove('active');
          }
        });
        this.classList.add('active');
        
        const filter = this.dataset.filter;
        const sections = document.querySelectorAll('#channels-container > section');
        
        if (filter === 'all') {
          // Mostrar todas as seções e todos os canais
          sections.forEach(section => section.classList.remove('hidden'));
          document.querySelectorAll('.channel-card').forEach(card => card.classList.remove('hidden'));
        } else if (filter === 'favorites') {
          // Filtro de favoritos - mostrar apenas canais favoritados em todas as seções
          sections.forEach(section => section.classList.remove('hidden'));
          document.querySelectorAll('.channel-card').forEach(card => {
            const channelId = card.dataset.channelId;
            if (favoriteChannels[channelId]) {
              card.classList.remove('hidden');
            } else {
              card.classList.add('hidden');
            }
          });
        } else {
          // Filtro por categoria específica
          sections.forEach(section => {
            if (section.id === `${filter}-section`) {
              section.classList.remove('hidden');
              section.querySelectorAll('.channel-card').forEach(card => card.classList.remove('hidden'));
            } else {
              section.classList.add('hidden');
            }
          });
        }
        
        checkEmptySections();
      }
      
      function handleTimeFilterClick() {
        const timeRange = this.dataset.time;
        const now = new Date();
        const currentHour = now.getHours();
        
        document.querySelectorAll('.programme-item').forEach(item => {
          const timeText = item.querySelector('.programme-time').textContent;
          const hourMatch = timeText.match(/(\d{1,2}):\d{2}/);
          if (!hourMatch) return;
          
          const hour = parseInt(hourMatch[1]);
          let showItem = false;
          
          switch(timeRange) {
            case 'morning':
              showItem = hour >= 6 && hour < 12;
              break;
            case 'afternoon':
              showItem = hour >= 12 && hour < 18;
              break;
            case 'evening':
              showItem = hour >= 18 || hour < 6;
              break;
            default:
              showItem = true;
          }
          
          item.style.display = showItem ? 'block' : 'none';
        });
      }
      
      function fetchEPGData() {
        fetch(epgXmlUrl)
          .then(response => {
            if (!response.ok) throw new Error('Não foi possível carregar o arquivo XML');
            return response.text();
          })
          .then(xmlText => {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
            processEPGData(xmlDoc);
            
            const now = new Date();
            lastUpdateDisplay.textContent = now.toLocaleTimeString('pt-BR', {
              hour: '2-digit',
              minute: '2-digit'
            });
            
            if (autoUpdateTimer) clearInterval(autoUpdateTimer);
            autoUpdateTimer = setInterval(handleReload, AUTO_UPDATE_INTERVAL);
          })
          .catch(error => {
            console.error('Erro ao carregar o EPG:', error);
            loadingElement.classList.add('hidden');
            errorElement.textContent = `Erro ao carregar a programação: ${error.message}`;
            errorElement.classList.remove('hidden');
          });
      }
      
      function processEPGData(xmlDoc) {
        try {
          const channels = xmlDoc.getElementsByTagName('channel');
          const programmes = xmlDoc.getElementsByTagName('programme');
          
          allProgrammesByChannel = {};
          
          // Agrupar programas por canal
          for (let i = 0; i < programmes.length; i++) {
            const programme = programmes[i];
            const channelId = programme.getAttribute('channel');
            
            if (!allProgrammesByChannel[channelId]) {
              allProgrammesByChannel[channelId] = [];
            }
            
            allProgrammesByChannel[channelId].push(programme);
          }
          
          // Processar cada canal
          for (let i = 0; i < channels.length; i++) {
            const channel = channels[i];
            const channelId = channel.getAttribute('id');
            const displayName = channel.getElementsByTagName('display-name')[0]?.textContent || 'Canal sem nome';
            
            createAndAppendChannelCard(displayName, channelId);
          }
          
          checkEmptySections();
          loadingElement.classList.add('hidden');
          channelsContainer.classList.remove('hidden');
          updateLivePrograms();
          
        } catch (error) {
          console.error('Erro ao processar o EPG:', error);
          loadingElement.classList.add('hidden');
          errorElement.textContent = `Erro ao processar a programação: ${error.message}`;
          errorElement.classList.remove('hidden');
        }
      }
      
      function updateLivePrograms() {
        const now = new Date();
        document.querySelectorAll('.programme-item').forEach(item => {
          const startTime = new Date(item.dataset.start);
          const endTime = new Date(item.dataset.end);
          
          if (startTime <= now && endTime > now) {
            if (!item.querySelector('.live-indicator')) {
              const liveIndicator = document.createElement('span');
              liveIndicator.className = 'live-indicator';
              liveIndicator.textContent = 'AO VIVO';
              item.querySelector('.programme-time').appendChild(liveIndicator);
            }
            item.classList.add('bg-orange-100', 'bg-opacity-10');
          } else {
            const indicator = item.querySelector('.live-indicator');
            if (indicator) indicator.remove();
            item.classList.remove('bg-orange-100', 'bg-opacity-10');
          }
        });
      }
      
      function checkEmptySections() {
        const sections = [
          { id: 'movies-section', container: moviesChannels },
          { id: 'documentary-section', container: documentaryChannels },
          { id: 'kids-section', container: kidsChannels },
          { id: 'sports-section', container: sportsChannels },
          { id: 'other-section', container: otherChannels }
        ];
        
        // Verificar qual filtro está ativo
        const activeFilter = document.querySelector('.filter-btn:not([data-time]).active')?.dataset.filter;
        
        sections.forEach(section => {
          const sectionElement = document.getElementById(section.id);
          
          // Se não for o filtro "all" ou "favorites", e não for a seção do filtro ativo, ocultar
          if (activeFilter && activeFilter !== 'all' && activeFilter !== 'favorites' && section.id !== `${activeFilter}-section`) {
            sectionElement.classList.add('hidden');
            return;
          }
          
          // Para filtro "all" ou "favorites", verificar se há canais visíveis
          const visibleChannels = section.container.querySelectorAll('.channel-card:not(.hidden)');
          if (visibleChannels.length === 0) {
            sectionElement.classList.add('hidden');
          } else {
            sectionElement.classList.remove('hidden');
          }
        });
      }
      
      function parseEPGDate(dateString) {
        const year = parseInt(dateString.substring(0, 4));
        const month = parseInt(dateString.substring(4, 6)) - 1;
        const day = parseInt(dateString.substring(6, 8));
        const hour = parseInt(dateString.substring(8, 10));
        const minute = parseInt(dateString.substring(10, 12));
        const second = parseInt(dateString.substring(12, 14));
        
        return new Date(year, month, day, hour, minute, second);
      }
      
      function formatDateTime(date) {
        const weekday = weekdaysShort[date.getDay()];
        return `${date.toLocaleTimeString('pt-BR', {
          hour: '2-digit',
          minute: '2-digit'
        })} | ${weekday}`;
      }
      
      function formatFullDateTime(date) {
        const weekday = weekdaysShort[date.getDay()];
        return `${date.toLocaleDateString('pt-BR', {
          day: '2-digit',
          month: '2-digit'
        })} ${date.toLocaleTimeString('pt-BR', {
          hour: '2-digit',
          minute: '2-digit'
        })} | ${weekday}`;
      }
      
      function getChannelLogo(channelName) {
        for (const [key, url] of Object.entries(channelLogos)) {
          if (channelName.includes(key)) {
            return url;
          }
        }
        
        return `https://via.placeholder.com/50x30/1a1a2e/ffffff?text=${encodeURIComponent(channelName.substring(0, 3))}`;
      }
      
      function getRatingImage(rating) {
        if (!rating) return null;
        
        rating = rating.toUpperCase();
        
        if (rating.includes('LIVRE') || rating === 'L') return ratingImages['L'];
        if (rating.includes('10') || rating.includes('DEZ')) return ratingImages['10'];
        if (rating.includes('12') || rating.includes('DOZE')) return ratingImages['12'];
        if (rating.includes('14') || rating.includes('QUATORZE')) return ratingImages['14'];
        if (rating.includes('16') || rating.includes('DEZESSEIS')) return ratingImages['16'];
        if (rating.includes('18') || rating.includes('DEZOITO')) return ratingImages['18'];
        
        return null;
      }
      
      function getExactlyFiveProgrammes(programmes) {
        const now = new Date();
        const sortedProgrammes = [...programmes].sort((a, b) => {
          const startTimeA = parseEPGDate(a.getAttribute('start'));
          const startTimeB = parseEPGDate(b.getAttribute('start'));
          return startTimeA - startTimeB;
        });
        
        let currentIndex = -1;
        
        for (let i = 0; i < sortedProgrammes.length; i++) {
          const startTime = parseEPGDate(sortedProgrammes[i].getAttribute('start'));
          const endTime = parseEPGDate(sortedProgrammes[i].getAttribute('stop'));
          
          if (startTime <= now && endTime > now) {
            currentIndex = i;
            break;
          }
        }
        
        if (currentIndex === -1) {
          for (let i = 0; i < sortedProgrammes.length; i++) {
            const startTime = parseEPGDate(sortedProgrammes[i].getAttribute('start'));
            if (startTime > now) {
              currentIndex = i;
              break;
            }
          }
        }
        
        if (currentIndex === -1) return [];
        return sortedProgrammes.slice(currentIndex, currentIndex + 5);
      }
      
      function createAndAppendChannelCard(channelName, channelId) {
        const channelProgrammes = allProgrammesByChannel[channelId] || [];
        const exactlyOneProgramme = getExactlyFiveProgrammes(channelProgrammes).slice(0, 1);
        const channelCard = createChannelCard(channelName, exactlyOneProgramme, channelId);
        
        let categoryFound = false;
        for (const [category, channelList] of Object.entries(channelCategories)) {
          if (channelList.some(name => channelName.toLowerCase().includes(name.toLowerCase()))) {
            categoryFound = true;
            const categorySectionId = `${category}-section`;
            const categoryContainer = document.getElementById(`${category}-channels`);
            
            if (categoryContainer) {
              categoryContainer.appendChild(channelCard);
              channelCard.dataset.category = category;
            } else {
              otherChannels.appendChild(channelCard);
              channelCard.dataset.category = 'other';
            }
            break;
          }
        }
        
        if (!categoryFound) {
          otherChannels.appendChild(channelCard);
          channelCard.dataset.category = 'other';
        }
      }
      
      function createChannelCard(channelName, programmes, channelId) {
        const card = document.createElement('div');
        card.className = 'channel-card';
        card.dataset.channelId = channelId;
        
        // Cabeçalho
        const header = document.createElement('div');
        header.className = 'bg-gray-800 p-2 flex items-center min-h-[50px]';
        
        const logoElement = document.createElement('img');
        logoElement.className = 'h-10 w-10 min-w-[40px] mr-2 object-contain';
        logoElement.src = getChannelLogo(channelName);
        logoElement.alt = `${channelName} Logo`;
        logoElement.onerror = function() {
          this.onerror = null;
          this.src = `https://via.placeholder.com/50x30/1a1a2e/ffffff?text=${encodeURIComponent(channelName.substring(0, 3))}`;
        };
        
        const nameElement = document.createElement('h3');
        nameElement.className = 'channel-name text-sm font-semibold text-white';
        nameElement.textContent = channelName.length > 20 ? 
          channelName.substring(0, 20) + '...' : channelName;
        nameElement.title = channelName;
        
        // Adicionar coração de favoritos
        const isFavorite = favoriteChannels[channelId];
        
        const heartIcon = document.createElement('span');
        heartIcon.className = `favorite-heart ml-auto ${isFavorite ? 'active' : ''}`;
        heartIcon.innerHTML = isFavorite ? '❤️' : '🤍';
        heartIcon.dataset.channel = channelId;
        heartIcon.onclick = (e) => {
          e.stopPropagation();
          toggleFavorite(channelId);
        };
        
        header.appendChild(logoElement);
        header.appendChild(nameElement);
        header.appendChild(heartIcon);
        card.appendChild(header);
        
        // Lista de programas
        const programmesList = document.createElement('div');
        programmesList.className = 'programmes-list p-2 space-y-2 flex-grow';
        
        if (programmes.length === 0) {
          programmesList.innerHTML = '<p class="text-gray-400 italic text-sm">Sem programação</p>';
        } else {
          programmes.forEach((programme, index) => {
            programmesList.appendChild(createProgrammeItem(programme, index === 0));
          });
        }
        
        card.appendChild(programmesList);
        
        // Botão
        const button = document.createElement('button');
        button.className = 'mt-auto mx-2 mb-2 py-1 text-sm bg-vibrant-orange hover:bg-orange-600 text-white rounded transform hover:scale-105 shadow-sm';
        button.textContent = 'Ver Próximas Programações';
        button.onclick = () => showFullSchedule(channelName, channelId, logoElement.src);
        
        card.appendChild(button);
        
        return card;
      }
      
      function toggleFavorite(channelId) {
        favoriteChannels[channelId] = !favoriteChannels[channelId];
        localStorage.setItem('favoriteChannels', JSON.stringify(favoriteChannels));
        
        // Atualizar UI
        const heartIcon = document.querySelector(`.favorite-heart[data-channel="${channelId}"]`);
        if (heartIcon) {
          heartIcon.classList.toggle('active');
          heartIcon.innerHTML = favoriteChannels[channelId] ? '❤️' : '🤍';
        }
        
        // Se o filtro de favoritos estiver ativo, atualiza a exibição
        const favoriteFilter = document.querySelector('.filter-btn[data-filter="favorites"].active');
        if (favoriteFilter) {
          const channelCard = document.querySelector(`.channel-card[data-channel-id="${channelId}"]`);
          if (channelCard) {
            if (favoriteChannels[channelId]) {
              channelCard.classList.remove('hidden');
            } else {
              channelCard.classList.add('hidden');
            }
          }
          checkEmptySections();
        }
      }
      
      function createProgrammeItem(programme, isCurrent = false) {
        const startTime = parseEPGDate(programme.getAttribute('start'));
        const endTime = parseEPGDate(programme.getAttribute('stop'));
        const title = programme.getElementsByTagName('title')[0]?.textContent || 'Programa sem título';
        const description = programme.getElementsByTagName('desc')[0]?.textContent || '';
        
        let ratingValue = null;
        const ratingElements = programme.getElementsByTagName('rating');
        if (ratingElements.length > 0) {
          const valueElement = ratingElements[0].getElementsByTagName('value')[0];
          if (valueElement) ratingValue = valueElement.textContent;
        }
        
        const programmeItem = document.createElement('div');
        programmeItem.className = 'programme-item';
        programmeItem.dataset.start = startTime;
        programmeItem.dataset.end = endTime;
        
        const now = new Date();
        if (isCurrent && startTime <= now && endTime > now) {
          programmeItem.classList.add('bg-gray-800', 'bg-opacity-30');
        }
        
        const timeElement = document.createElement('div');
        timeElement.className = 'programme-time text-xs text-orange-400 flex items-center';
        
        const timeText = document.createElement('span');
        timeText.textContent = `${formatDateTime(startTime)} - ${formatDateTime(endTime)}`;
        timeElement.appendChild(timeText);
        
        if (startTime <= now && endTime > now) {
          const liveIndicator = document.createElement('span');
          liveIndicator.className = 'live-indicator';
          liveIndicator.textContent = 'AO VIVO';
          timeElement.appendChild(liveIndicator);
        }
        
        const titleElement = document.createElement('div');
        titleElement.className = 'programme-title font-medium text-sm mt-1';
        titleElement.textContent = title.length > 30 ? 
          title.substring(0, 30) + '...' : title;
        titleElement.title = title;
        
        const ratingImageUrl = getRatingImage(ratingValue);
        if (ratingImageUrl) {
          const ratingImg = document.createElement('img');
          ratingImg.className = 'rating-icon ml-2';
          ratingImg.src = ratingImageUrl;
          ratingImg.alt = `Classificação ${ratingValue}`;
          titleElement.appendChild(ratingImg);
        }
        
        programmeItem.appendChild(timeElement);
        programmeItem.appendChild(titleElement);
        
        if (description) {
          const descElement = document.createElement('div');
          descElement.className = 'programme-desc text-xs text-gray-400 mt-1';
          descElement.textContent = description.length > 60 ? 
            description.substring(0, 60) + '...' : description;
          descElement.title = description;
          programmeItem.appendChild(descElement);
        }
        
        return programmeItem;
      }
      
      function showFullSchedule(channelName, channelId, logoUrl) {
        modalChannelName.textContent = channelName;
        modalChannelLogo.src = logoUrl;
        modalChannelLogo.alt = `${channelName} Logo`;
        modalScheduleList.innerHTML = '';
        
        const channelProgrammes = allProgrammesByChannel[channelId] || [];
        const now = new Date();
        
        const futureProgrammes = channelProgrammes
          .filter(programme => {
            const endTime = parseEPGDate(programme.getAttribute('stop'));
            return endTime > now;
          })
          .sort((a, b) => {
            const startTimeA = parseEPGDate(a.getAttribute('start'));
            const startTimeB = parseEPGDate(b.getAttribute('start'));
            return startTimeA - startTimeB;
          });
        
        if (futureProgrammes.length === 0) {
          modalScheduleList.innerHTML = '<p class="text-gray-400 italic text-center py-4">Nenhuma programação disponível para as próximas 24 horas</p>';
        } else {
          const firstProgrammeDate = parseEPGDate(futureProgrammes[0].getAttribute('start'));
          const dateHeader = document.createElement('div');
          dateHeader.className = 'text-vibrant-orange font-bold text-lg mb-2 border-b border-gray-700 pb-1';
          dateHeader.textContent = firstProgrammeDate.toLocaleDateString('pt-BR', { 
            weekday: 'long', 
            day: '2-digit', 
            month: '2-digit', 
            year: 'numeric' 
          });
          modalScheduleList.appendChild(dateHeader);
          
          futureProgrammes.forEach(programme => {
            const startTime = parseEPGDate(programme.getAttribute('start'));
            const endTime = parseEPGDate(programme.getAttribute('stop'));
            const title = programme.getElementsByTagName('title')[0]?.textContent || 'Programa sem título';
            const description = programme.getElementsByTagName('desc')[0]?.textContent || '';
            
            let ratingValue = null;
            const ratingElements = programme.getElementsByTagName('rating');
            if (ratingElements.length > 0) {
              const valueElement = ratingElements[0].getElementsByTagName('value')[0];
              if (valueElement) ratingValue = valueElement.textContent;
            }
            
            const programmeItem = document.createElement('div');
            programmeItem.className = 'bg-gray-800 bg-opacity-30 rounded-md p-3 mb-2';
            
            const now = new Date();
            if (startTime <= now && endTime > now) {
              programmeItem.classList.add('border', 'border-vibrant-orange');
            }
            
            const timeElement = document.createElement('div');
            timeElement.className = 'flex items-center text-sm font-medium text-vibrant-orange mb-1';
            
            const startWeekday = weekdaysShort[startTime.getDay()];
            const endWeekday = weekdaysShort[endTime.getDay()];
            
            timeElement.innerHTML = `${startTime.toLocaleTimeString('pt-BR', {
              hour: '2-digit',
              minute: '2-digit'
            })} | ${startWeekday} - ${endTime.toLocaleTimeString('pt-BR', {
              hour: '2-digit',
              minute: '2-digit'
            })} | ${endWeekday}`;
            
            if (startTime <= now && endTime > now) {
              const liveIndicator = document.createElement('span');
              liveIndicator.className = 'live-indicator';
              liveIndicator.textContent = 'AO VIVO';
              timeElement.appendChild(liveIndicator);
            }
            
            const titleElement = document.createElement('div');
            titleElement.className = 'font-medium';
            titleElement.textContent = title;
            
            const ratingImageUrl = getRatingImage(ratingValue);
            if (ratingImageUrl) {
              const ratingImg = document.createElement('img');
              ratingImg.className = 'rating-icon ml-2';
              ratingImg.src = ratingImageUrl;
              ratingImg.alt = `Classificação ${ratingValue}`;
              titleElement.appendChild(ratingImg);
            }
            
            programmeItem.appendChild(timeElement);
            programmeItem.appendChild(titleElement);
            
            if (description) {
              const descElement = document.createElement('div');
              descElement.className = 'text-sm text-gray-300 mt-1';
              descElement.textContent = description;
              programmeItem.appendChild(descElement);
            }
            
            modalScheduleList.appendChild(programmeItem);
          });
        }
        
        modal.style.display = 'block';
        
        // Configurar o botão de fechar
        modalClose.onclick = function() {
          modal.style.display = 'none';
        };
      }
      
      // Função para buscar trailer de um filme com hierarquia de idiomas
      async function buscarTrailer(tituloFilme) {
        // Normaliza título e verifica no cache primeiro
        const tituloNormalizado = normalizarTitulo(tituloFilme);
        if (trailerCache[tituloNormalizado]) {
          return mostrarTrailer(trailerCache[tituloNormalizado]);
        }

        try {
          // Passo 1: Busca o filme na API
          const urlBusca = `https://api.themoviedb.org/3/search/movie?api_key=${tmdbApiKey}&query=${encodeURIComponent(tituloNormalizado)}`;
          
          const respostaBusca = await fetch(urlBusca);
          const dadosBusca = await respostaBusca.json();

          if (!dadosBusca.results?.length) {
            console.log('Nenhum resultado encontrado para:', tituloNormalizado);
            return mostrarTrailerNaoEncontrado();
          }

          // Passo 2: Obtém o ID do primeiro resultado
          const idFilme = dadosBusca.results[0].id;

          // Hierarquia de busca de trailers:
          // 1. Primeiro tenta em português brasileiro (pt-BR)
          // 2. Se não encontrar, tenta versões legendadas (pt)
          // 3. Por último, qualquer versão disponível
          const linguagensParaTentar = ['pt-BR', 'pt', 'en'];
          let trailerEncontrado = null;

          for (const lingua of linguagensParaTentar) {
            const urlVideos = `https://api.themoviedb.org/3/movie/${idFilme}/videos?api_key=${tmdbApiKey}&language=${lingua}`;
            const respostaVideos = await fetch(urlVideos);
            const dadosVideos = await respostaVideos.json();

            // Procura por trailers do YouTube
            trailerEncontrado = dadosVideos.results.find(video => 
              video.site === 'YouTube' && video.type === 'Trailer'
            );

            if (trailerEncontrado) break; // Se encontrou, sai do loop
          }

          if (trailerEncontrado) {
            const urlTrailer = `https://www.youtube.com/embed/${trailerEncontrado.key}?autoplay=1`;
            // Armazena no cache
            trailerCache[tituloNormalizado] = urlTrailer;
            localStorage.setItem('trailerCache', JSON.stringify(trailerCache));
            mostrarTrailer(urlTrailer);
          } else {
            mostrarTrailerNaoEncontrado();
          }
        } catch (erro) {
          console.error('Erro ao buscar trailer:', erro);
          mostrarTrailerNaoEncontrado();
        }
      }
      
      // Função auxiliar para normalizar títulos de filmes
      function normalizarTitulo(titulo) {
        return titulo
          .normalize("NFD").replace(/[\u0300-\u036f]/g, "") // Remove acentos
          .replace(/[^\w\s]/gi, '') // Remove caracteres especiais
          .toLowerCase()
          .trim();
      }
      
      function mostrarTrailer(trailerUrl) {
        trailerNotFound.classList.add('hidden');
        
        // Cria o iframe
        const iframe = document.createElement('iframe');
        iframe.className = 'trailer-iframe';
        iframe.src = trailerUrl;
        iframe.setAttribute('allowfullscreen', '');
        iframe.setAttribute('allow', 'autoplay');
        
        // Limpa o container e adiciona o iframe
        trailerContainer.innerHTML = '';
        trailerContainer.appendChild(iframe);
        
        // Mostra o modal
        trailerModal.style.display = 'block';
      }
      
      function mostrarTrailerNaoEncontrado() {
        trailerContainer.innerHTML = '';
        trailerNotFound.classList.remove('hidden');
        trailerModal.style.display = 'block';
      }

      async function carregarFilmes() {
        const container = document.getElementById("filmes");
        container.innerHTML = '<div class="loading-spinner mx-auto"></div>';
        
        const canais = [
          "Telecine Action", "Telecine Premium", "Telecine Pipoca", "Megapix", "HBO Family", "HBO", "HBO2",
          "Cinemax", "Telecine Touch", "Paramount", "Telecine Fun"
        ];
        
        try {
          const response = await fetch(epgXmlUrl);
          const xmlText = await response.text();
          const parser = new DOMParser();
          const xml = parser.parseFromString(xmlText, "text/xml");
          
          const programas = Array.from(xml.getElementsByTagName("programme"));
          const hoje = new Date();
          
          // Criar array com as datas dos próximos 3 dias (hoje + 3 dias)
          const diasParaBuscar = [];
          for (let i = 0; i < 4; i++) { // 0 = hoje, 1 = amanhã, etc.
            const data = new Date(hoje);
            data.setDate(hoje.getDate() + i);
            diasParaBuscar.push(data.toISOString().split("T")[0].replace(/-/g, ""));
          }
          
          const titulosUnicos = new Set();
          container.innerHTML = "";
          
          // Buscar filmes em cada um dos dias
          for (const dia of diasParaBuscar) {
            for (const canal of canais) {
              const programasDoCanal = programas.filter(p => {
                const channel = p.getAttribute("channel") || "";
                const start = p.getAttribute("start") || "";
                
                const startTime = new Date(
                  parseInt(start.slice(0, 4)),
                  parseInt(start.slice(4, 6)) - 1,
                  parseInt(start.slice(6, 8)),
                  parseInt(start.slice(8, 10)),
                  parseInt(start.slice(10, 12))
                );
                
                const endTime = new Date(
                  parseInt(p.getAttribute("stop").slice(0, 4)),
                  parseInt(p.getAttribute("stop").slice(4, 6)) - 1,
                  parseInt(p.getAttribute("stop").slice(6, 8)),
                  parseInt(p.getAttribute("stop").slice(8, 10)),
                  parseInt(p.getAttribute("stop").slice(10, 12))
                );
                
                // Filtra para incluir apenas filmes (exclui séries, programas, etc.)
                const title = p.getElementsByTagName("title")[0]?.textContent || "";
                const isMovie = !title.match(/(EP\.|Episódio|Série|Temporada|Programa|Show|Novela)/i);
                
                return channel.toLowerCase().includes(canal.toLowerCase()) &&
                       start.startsWith(dia) &&
                       (startTime >= new Date() || (startTime <= new Date() && endTime > new Date())) && // Mostra programas futuros ou ao vivo
                       isMovie; // Apenas filmes
              });
              
              for (const filme of programasDoCanal) {
                const titleRaw = filme.getElementsByTagName("title")[0]?.textContent || "Sem título";
                const titleClean = normalizarTitulo(titleRaw);
                
                // Verifica se o título já foi adicionado e se não contém "EP" ou "Episódio"
                if (titulosUnicos.has(titleClean)) continue;
                
                const { image: img, rating } = await buscarImagemFilme(titleRaw);
                if (img.includes("via.placeholder.com")) continue;
                
                titulosUnicos.add(titleClean);
                
                const channel = filme.getAttribute("channel");
                const start = filme.getAttribute("start");
                const stop = filme.getAttribute("stop");
                const startTime = new Date(
                  parseInt(start.slice(0, 4)),
                  parseInt(start.slice(4, 6)) - 1,
                  parseInt(start.slice(6, 8)),
                  parseInt(start.slice(8, 10)),
                  parseInt(start.slice(10, 12))
                );
                const endTime = new Date(
                  parseInt(stop.slice(0, 4)),
                  parseInt(stop.slice(4, 6)) - 1,
                  parseInt(stop.slice(6, 8)),
                  parseInt(stop.slice(8, 10)),
                  parseInt(stop.slice(10, 12))
                );
                
                const agora = new Date();
                const estaAoVivo = startTime <= agora && endTime > agora;
                
                // Formata a data completa para exibição
                const dataExibicao = new Date(
                  parseInt(start.slice(0, 4)),
                  parseInt(start.slice(4, 6)) - 1,
                  parseInt(start.slice(6, 8))
                );
                const diaSemana = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'][dataExibicao.getDay()];
                const diaMes = dataExibicao.getDate().toString().padStart(2, '0');
                const mes = (dataExibicao.getMonth() + 1).toString().padStart(2, '0');
                const dataFormatada = `${diaMes}/${mes}`;
                
                // Obter classificação indicativa
                let ratingIndicativa = "L";
                const ratingElement = filme.getElementsByTagName("rating")[0];
                if (ratingElement) {
                  const valueElement = ratingElement.getElementsByTagName("value")[0];
                  if (valueElement) {
                    ratingIndicativa = valueElement.textContent;
                    // Normaliza a classificação
                    if (ratingIndicativa.includes('LIVRE') || ratingIndicativa === 'L') ratingIndicativa = 'L';
                    else if (ratingIndicativa.includes('10') || ratingIndicativa.includes('DEZ')) ratingIndicativa = '10';
                    else if (ratingIndicativa.includes('12') || ratingIndicativa.includes('DOZE')) ratingIndicativa = '12';
                    else if (ratingIndicativa.includes('14') || ratingIndicativa.includes('QUATORZE')) ratingIndicativa = '14';
                    else if (ratingIndicativa.includes('16') || ratingIndicativa.includes('DEZESSEIS')) ratingIndicativa = '16';
                    else if (ratingIndicativa.includes('18') || ratingIndicativa.includes('DEZOITO')) ratingIndicativa = '18';
                  }
                }
                
                // Obter logo do canal
                let channelLogo = '';
                for (const [key, url] of Object.entries(channelLogos)) {
                  if (channel.includes(key)) {
                    channelLogo = `<img src="${url}" alt="${key}" class="channel-logo">`;
                    break;
                  }
                }
                
                // Obter imagem da classificação indicativa
                const ratingImg = ratingImages[ratingIndicativa] || ratingImages['L'];
                
                // Determinar a classe de cor com base na avaliação
                let ratingClass = '';
                if (rating !== null) {
                  if (rating >= 70) ratingClass = 'rating-high';
                  else if (rating >= 50) ratingClass = 'rating-medium';
                  else ratingClass = 'rating-low';
                }
                
                const card = document.createElement("div");
                card.className = `movie-card ${estaAoVivo ? 'movie-card-live' : ''}`;
                card.innerHTML = `
                  <div class="movie-poster-container relative">
                    ${estaAoVivo ? '<span class="live-badge">AO VIVO AGORA</span>' : ''}
                    <img src="${img}" alt="${titleRaw}" class="w-full h-60 object-cover mb-2 rounded" loading="lazy">
                    ${rating !== null ? `
                      <div class="rating-circle ${ratingClass}">
                        ${rating}%
                      </div>
                    ` : ''}
                  </div>
                  <h3 class="text-sm font-bold text-white">${titleRaw}</h3>
                  <div class="flex items-center justify-between mt-1">
                    <div class="flex items-center">
                      ${channelLogo}
                      <p class="text-xs text-gray-300">${channel}</p>
                    </div>
                    <span class="text-xs bg-gray-700 px-2 py-1 rounded">${diaSemana} ${dataFormatada}</span>
                  </div>
                  <div class="flex items-center justify-between mt-1">
                    <p class="text-xs ${estaAoVivo ? 'text-red-400 font-bold' : 'text-gray-300'}">
                      ${estaAoVivo ? 
                        `AO VIVO até ${endTime.toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'})}` : 
                        `Horário: ${startTime.toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'})}`}
                    </p>
                    <img src="${ratingImg}" alt="Classificação ${ratingIndicativa}" class="h-4">
                  </div>
                  <button class="ver-trailer-btn mt-2 w-full py-1 bg-vibrant-orange text-white rounded text-xs hover:bg-orange-600 transition-colors" data-titulo="${titleRaw}">
                    Ver Trailer
                  </button>
                  <button class="mais-detalhes-btn" 
                          data-titulo="${titleRaw}" 
                          data-canal="${channel}"
                          data-horario="${startTime.getTime()}">
                    Mais Detalhes
                  </button>
                `;
                container.appendChild(card);
                
                // Adicionar evento de clique ao botão de trailer
                card.querySelector('.ver-trailer-btn').addEventListener('click', (e) => {
                  e.stopPropagation();
                  buscarTrailer(e.target.dataset.titulo);
                });
                
                // Adicionar evento de clique ao botão de mais detalhes
                card.querySelector('.mais-detalhes-btn').addEventListener('click', (e) => {
                  e.stopPropagation();
                  abrirDetalhesFilme(
                    e.target.dataset.titulo,
                    e.target.dataset.canal,
                    parseInt(e.target.dataset.horario)
                  );
                });
                
                // Limitar a quantidade de filmes exibidos para não sobrecarregar
                if (titulosUnicos.size >= 30) break; // Limite de 30 filmes
              }
              if (titulosUnicos.size >= 30) break; // Limite de 30 filmes
            }
            if (titulosUnicos.size >= 30) break; // Limite de 30 filmes
          }
        } catch (error) {
          console.error("Erro ao carregar filmes:", error);
          container.innerHTML = '<p class="text-red-400 text-center py-4">Erro ao carregar filmes</p>';
        }
      }
      
      function atualizarStatusFilmes() {
        const cards = document.querySelectorAll('.movie-card');
        const agora = new Date();
        
        cards.forEach(card => {
          const horarioElement = card.querySelector('.mais-detalhes-btn');
          if (!horarioElement) return;
          
          const horario = parseInt(horarioElement.dataset.horario);
          const startTime = new Date(horario);
          const endTime = new Date(horario + (2 * 60 * 60 * 1000)); // Assumindo 2 horas de duração
          
          const estaAoVivo = startTime <= agora && endTime > agora;
          
          if (estaAoVivo) {
            card.classList.add('movie-card-live');
            
            // Atualiza o badge AO VIVO se não existir
            if (!card.querySelector('.live-badge')) {
              const badge = document.createElement('span');
              badge.className = 'live-badge';
              badge.textContent = 'AO VIVO AGORA';
              card.querySelector('.movie-poster-container').prepend(badge);
            }
            
            // Atualiza o texto do horário
            const horarioText = card.querySelector('p.text-xs');
            if (horarioText) {
              horarioText.classList.add('text-red-400', 'font-bold');
              horarioText.classList.remove('text-gray-300');
              horarioText.textContent = `AO VIVO até ${endTime.toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'})}`;
            }
          } else {
            card.classList.remove('movie-card-live');
            const badge = card.querySelector('.live-badge');
            if (badge) badge.remove();
            
            const horarioText = card.querySelector('p.text-xs');
            if (horarioText && startTime > agora) {
              horarioText.classList.remove('text-red-400', 'font-bold');
              horarioText.classList.add('text-gray-300');
              horarioText.textContent = `Horário: ${startTime.toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'})}`;
            }
          }
        });
      }
      
      async function buscarImagemFilme(tituloOriginal) {
        const variacoes = [
          tituloOriginal,
          tituloOriginal.normalize("NFD").replace(/[\u0300-\u036f]/g, ""),
          tituloOriginal.split(":")[0],
          tituloOriginal.split("-")[0],
          tituloOriginal.replace(/\s+\d{4}$/, "")
        ];
        
        for (const titulo of variacoes) {
          try {
            const resposta = await fetch(`https://api.themoviedb.org/3/search/movie?api_key=${tmdbApiKey}&query=${encodeURIComponent(titulo.trim())}`);
            const dados = await resposta.json();
            
            const filme = dados.results?.find(f => f.poster_path || f.backdrop_path);
            
            if (filme) {
              return {
                image: filme.poster_path ? `https://image.tmdb.org/t/p/w500${filme.poster_path}` : `https://image.tmdb.org/t/p/w500${filme.backdrop_path}`,
                rating: filme.vote_average ? Math.round(filme.vote_average * 10) : null
              };
            }
          } catch (erro) {
            console.error("Erro ao buscar imagem:", titulo, erro);
          }
        }
        
        return {
          image: `https://via.placeholder.com/300x450?text=${encodeURIComponent(tituloOriginal)}`,
          rating: null
        };
      }

      // Inicialização
      updateCurrentTime();
      setInterval(updateCurrentTime, 1000);
      
      // Configurar botão voltar ao topo
      window.addEventListener('scroll', () => {
        if (window.pageYOffset > 300) {
          backToTopButton.classList.remove('hidden');
        } else {
          backToTopButton.classList.add('hidden');
        }
      });
      
      backToTopButton.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
      
      // Configurar modal de trailer
      trailerClose.addEventListener('click', () => {
        trailerModal.style.display = 'none';
        // Remove o iframe quando o modal é fechado
        const iframe = trailerContainer.querySelector('iframe');
        if (iframe) {
          iframe.remove();
        }
        trailerNotFound.classList.add('hidden');
      });
      
      window.addEventListener('click', (event) => {
        if (event.target === trailerModal) {
          trailerModal.style.display = 'none';
          // Remove o iframe quando o modal é fechado
          const iframe = trailerContainer.querySelector('iframe');
          if (iframe) {
            iframe.remove();
          }
          trailerNotFound.classList.add('hidden');
        }
      });
      
      // Configurar menu lateral
      const menu = document.getElementById('side-menu');
      const menuButton = document.getElementById('menu-button');
      const closeButton = document.getElementById('close-menu');
      const overlay = document.getElementById('menu-overlay');

      function abrirMenu() {
        menu.classList.remove('translate-x-full');
        overlay.classList.remove('hidden');
      }

      function fecharMenu() {
        menu.classList.add('translate-x-full');
        overlay.classList.add('hidden');
      }

      menuButton.addEventListener('click', abrirMenu);
      closeButton.addEventListener('click', fecharMenu);
      overlay.addEventListener('click', fecharMenu);

      function mostrarSobre() {
        fecharMenu();
        alert('MaxPlay TV - Guia de Programação interativo.');
      }

      function logout() {
        fecharMenu();
        alert('Você saiu. Redirecionando...');
      }
      
      // Iniciar carregamento dos dados
      fetchEPGData();
      carregarFilmes();
      
      // Atualizar status dos filmes periodicamente
      setInterval(atualizarStatusFilmes, 60000); // Atualiza a cada minuto
      
      // Event Listeners
      channelSearch.addEventListener('input', handleSearch);
      modalClose.addEventListener('click', () => modal.style.display = 'none');
      window.addEventListener('click', (event) => {
        if (event.target === modal) modal.style.display = 'none';
      });
      
      filterButtons.forEach(button => {
        button.addEventListener('click', function() {
          if (this.dataset.time) {
            handleTimeFilterClick.call(this);
          } else {
            handleFilterClick.call(this);
          }
        });
      });
    });
  </script>
</body>
</html>